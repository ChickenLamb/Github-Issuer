(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5161)}])},5161:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var o=n(5893),a=n(9008),s=n.n(a),r=n(6720),l=n(2045),i=n(7294),c=n(2293),d=n(7357),u=n(155),h=n(5861),p=n(3321);function g(e){let{clientid:t}=e,n="https://github.com/login/oauth/authorize?client_id="+t+"&scope=repo";return(0,o.jsx)(d.Z,{sx:{flexGrow:1},children:(0,o.jsx)(c.Z,{position:"static",children:(0,o.jsxs)(u.Z,{children:[(0,o.jsx)(h.Z,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Github Issue Controller"}),(0,o.jsx)(p.Z,{tabIndex:2,color:"inherit",onClick:()=>{window.location.assign(n)},children:"Login"})]})})})}var m=n(3795),x=n(629),y=n(6447),f=n(9661),j=n(948),b=n(6574),_=n(6319),v=n(5819),C=n(2734);function Z(e){let{state:t,labels:n}=e,[a,s]=i.useState(null),r=Boolean(a),l=e=>{s(e.currentTarget)},c=()=>{s(null)},d=(0,C.Z)();return(0,o.jsxs)("div",{children:[(0,o.jsx)(p.Z,{id:"demo-positioned-button","aria-controls":r?"demo-positioned-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:l,style:{float:"left"},children:t}),(0,o.jsx)(_.Z,{id:"demo-positioned-menu","aria-labelledby":"demo-positioned-button",anchorEl:a,open:r,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},children:["Open","In Progress","Done"].map((e,n)=>(0,o.jsx)(v.Z,{style:{backgroundColor:e.toUpperCase()===t.toUpperCase()?d.palette.primary.main:d.palette.common.white},onClick:c,children:e},n))})]})}var k=n(7125),w=n(8085),S=n(5678);let A={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function L(e){let{query:t,SearchQuery:a,state:s,setState:r,token:l,LoadIssue:i}=e,c=()=>r({...s,window_state:!1});return(0,o.jsx)("div",{children:(0,o.jsx)(k.Z,{open:s.window_state,onClose:c,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,o.jsxs)(d.Z,{sx:A,children:[(0,o.jsx)(h.Z,{textAlign:"center",id:"modal-modal-title",variant:"h6",component:"h2",children:"ARE YOU SURE YOU WANT TO DELETE IT?"}),(0,o.jsxs)(w.Z,{spacing:3,children:[(0,o.jsx)(p.Z,{onClick:()=>{!function(){let e=S.Am.loading("Deleting..."),o=n(7218),c={method:"patch",maxBodyLength:1/0,url:s.close_url,headers:{Accept:"application/vnd.github+json",Authorization:"Bearer "+"".concat(l),"Content-Type":"application/json"},data:{state:"close"}};o.request(c).then(n=>{console.log(JSON.stringify(n.data)),200===n.status&&(r({...s,window_state:!1}),S.Am.update(e,{render:"Deleted Successfully",type:"success",isLoading:!1,autoClose:1500}),setTimeout(()=>{t.state?a(t.q):i(!0)},1500))}).catch(t=>{console.log(t),S.Am.update(e,{render:"Something went wrong",type:"error",isLoading:!1,autoClose:2500})})}()},children:"CONFIRM"}),(0,o.jsx)(p.Z,{onClick:()=>{c()},children:"CANCEL"})]})]})})})}let I=(0,j.ZP)(x.Z)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"#1A2027":"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary}});function E(e){let{query:t,SearchQuery:a,Data:s,token:r,callback:l,LoadIssue:c}=e,[u,g]=i.useState({window_state:!1}),x=n(381);return(0,o.jsxs)(d.Z,{maxWidth:"md",m:"auto",py:5,sx:{width:"100%"},children:[(0,o.jsx)(y.Z,{spacing:2,children:s.map((e,t)=>(0,o.jsxs)(I,{style:{minHeight:200},children:[(0,o.jsx)(Z,{state:e.state,labels:e.labels}),(0,o.jsxs)(y.Z,{direction:"row",justifyContent:"center",alignItems:"center",sx:{minWidth:0},children:[(0,o.jsxs)(b.Z,{component:"div",style:{minWidth:"80%"},children:[" ",(0,o.jsxs)(y.Z,{direction:"row",justifyContent:"left",alignItems:"center",spacing:1,ml:2,my:2,children:[(0,o.jsx)(I,{elevation:0,children:(0,o.jsx)(f.Z,{style:{marginRight:0,border:"1px solid black"},variant:"circular",alt:e.assignee_name,src:e.assignee_avatar_url})}),(0,o.jsx)(I,{elevation:0,children:(0,o.jsx)(h.Z,{variant:"h4",children:(0,o.jsx)(m.Z,{target:"_blank",href:e.html_url,underline:"hover",children:e.title})})})]}),(0,o.jsxs)(h.Z,{ml:2,my:1,textAlign:"left",component:"pre",variant:"body1",children:[(0,o.jsx)("strong",{children:"repo: "}),e.repository_name," ",(0,o.jsx)("strong",{children:"created_at: "}),x(e.date_created_at).format("dddd, D/M/YYYY"),"\n",(0,o.jsx)("strong",{children:"updated_at: "}),(0,o.jsx)("cite",{children:x(e.date_updated_at).format("dddd, D/M/YYYY, h:mm:ss a")})]}),(0,o.jsx)(h.Z,{ml:2,my:1,textAlign:"left",component:"pre",variant:"body1",children:e.body})]}),(0,o.jsxs)(b.Z,{component:"div",children:[" ",(0,o.jsxs)(y.Z,{direction:"column",justifyContent:"center",alignItems:"flex-start",spacing:1,style:{border:"1px solid black"},children:[(0,o.jsx)(I,{elevation:0,children:(0,o.jsx)(p.Z,{onClick:()=>l({body:e.body,title:e.title,open:!0,issue_url:e.url}),children:"Edit"})}),(0,o.jsx)(I,{elevation:0,children:(0,o.jsx)(p.Z,{onClick:()=>{g({window_state:!0,close_url:e.url})},children:"Delete"})})]})]})]})]},t))}),(0,o.jsx)(L,{query:t,SearchQuery:a,state:u,setState:g,token:r,LoadIssue:c})]})}var q=n(89),O=n(6357);let U={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function P(e){let{query:t,SearchQuery:a,updateForm:s,handleClose:r,token:l,LoadIssue:c}=e;async function u(e){var o;if(""!==e.title&&(null!==(o=e.body)&&void 0!==o?o:"").length>=30){let o=S.Am.loading("Updating..."),s=n(7218);console.log(e);let r={method:"patch",maxBodyLength:1/0,url:e.issue_url,headers:{Accept:"application/vnd.github+json",Authorization:"Bearer "+"".concat(l),"Content-Type":"application/json"},data:{title:e.title,body:e.body}};await s.request(r).then(e=>{200===e.status&&(S.Am.update(o,{render:"Update Successfully",type:"success",isLoading:!1,autoClose:1500}),setTimeout(()=>{t.state?a(t.q):c(!0)},1500))}).catch(e=>{console.log(e),S.Am.update(o,{render:"Something went wrong",type:"error",isLoading:!1,autoClose:2500})})}else(0,S.Am)("title 為必填,body 至少需要 30 字",{type:"error",autoClose:3500})}let[g,m]=i.useState(!1),[x,y]=i.useState({open:!1});return i.useEffect(()=>{s.open&&y(s)},[s.open]),i.useEffect(()=>console.log(x),[x]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(k.Z,{open:s.open,onClose:r,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,o.jsxs)(d.Z,{sx:U,children:[(0,o.jsxs)(h.Z,{variant:"h6",component:"span",children:["title:  ",(0,o.jsx)(q.Z,{onChange:e=>{y({...x,title:e.target.value})},defaultValue:s.title})]}),(0,o.jsx)("hr",{}),(0,o.jsx)(h.Z,{component:"span",style:{display:"flex",justifyContent:"center",alignContent:"center",padding:"5% 0"},children:(0,o.jsx)(O.Z,{fullWidth:!0,onChange:e=>{y({...x,body:e.target.value})},defaultValue:s.body,label:"Body",multiline:!0,maxRows:4})}),(0,o.jsx)("hr",{}),(0,o.jsx)(p.Z,{style:{float:"right"},onClick:()=>{u(x)},children:"Update"})]})})})}n(1399);var T=n(6886),B=n(6420);function D(){let[e,t]=i.useState(!1);return(0,o.jsx)(B.Z,{value:"check",selected:e,onChange:()=>{t(!e)},children:"滑到底部單次載入10筆"})}let N=(0,j.ZP)(x.Z)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"#1A2027":"#fff",...t.typography.body2,padding:t.spacing(1),textAlign:"center",color:t.palette.text.secondary,borderRadius:0}});function Y(e){let{setQuery:t,setIssues:n,token:a,LoadIssue:s,setSortOrder:r,sortOrder:l}=e,[u,g]=i.useState(""),m=(0,C.Z)(),x=e=>{"Enter"===e.key&&(e.preventDefault(),y())};function y(){t({state:!0,q:u})}return(0,o.jsx)(c.Z,{position:"sticky",children:(0,o.jsx)(d.Z,{style:{backgroundColor:m.palette.common.white},sx:{flexGrow:1},children:(0,o.jsxs)(T.ZP,{container:!0,spacing:0,children:[(0,o.jsxs)(T.ZP,{item:!0,xs:2,children:[(0,o.jsx)(N,{elevation:0,children:(0,o.jsx)(p.Z,{onClick:()=>s(!0),children:"Refresh"})}),(0,o.jsx)(N,{elevation:0,children:(0,o.jsx)(D,{})})]}),(0,o.jsx)(T.ZP,{item:!0,xs:7,children:(0,o.jsx)(N,{elevation:0,children:(0,o.jsxs)(d.Z,{component:"form",sx:{"& > :not(style)":{m:1.5}},style:{display:"flex"},ml:10,noValidate:!0,autoComplete:"on",children:[(0,o.jsx)(h.Z,{textAlign:"left",variant:"h6",children:"Search:"}),(0,o.jsx)(O.Z,{onKeyDown:x,onChange:e=>{g(e.target.value)},value:u,id:"outlined-basic",label:"What do you want to find?",variant:"outlined"}),(0,o.jsx)(p.Z,{onClick:()=>y(),children:"Search"}),(0,o.jsx)(p.Z,{onClick:()=>{t({state:!1,q:""}),g("")},children:"Clear Search"})]})})}),(0,o.jsxs)(T.ZP,{item:!0,xs:3,style:{display:"flex",gap:1,justifyContent:"flex-end",alignItems:"flex-start"},children:[(0,o.jsx)(N,{elevation:0,children:(0,o.jsx)(h.Z,{children:"Sort:"})}),["created","updated","comments"].map((e,t)=>(0,o.jsx)(N,{style:{backgroundColor:e.toUpperCase()===l.toUpperCase()?m.palette.primary.main:m.palette.common.white},elevation:0,children:(0,o.jsx)(p.Z,{style:{color:e.toUpperCase()===l.toUpperCase()?m.palette.common.black:m.palette.primary.main},disabled:e.toUpperCase()===l.toUpperCase(),onClick:()=>{r(e)},children:e})},t))]})]})})})}function R(){let e=(0,C.Z)(),t=n(7218),a=(0,i.useRef)([!0,!0,!0,!0,!0,!1]),[c,d]=(0,i.useState)({state:!1,q:""}),[u,h]=(0,i.useState)(),[p,m]=(0,i.useState)(""),[x,y]=(0,i.useState)({open:!1}),[f,j]=(0,i.useState)("created"),b=()=>{y({...x,open:!1}),a.current[3]=!0},_=e=>{y(e),a.current[3]=!0},v=e=>{h(e)},Z=e=>{j(e),a.current[4]=!0},k=e=>{d(e),a.current[5]=!0},w=async e=>{if(!0===e){let e=S.Am.loading("Fetching Issues...");a.current[2]=!0,console.log("trigger reload"),await t.request({method:"get",maxBodyLength:1/0,url:"https://github-get-token-api.vercel.app/api/get-issues-sort?token="+"".concat(p)+"&sort="+"".concat(f)}).then(t=>{console.log(t);let n=t.data.map(e=>({state:e.state,labels:e.labels,assignee_name:e.assignee.login,assignee_avatar_url:e.assignee.avatar_url,repository_name:e.repository.name,date_created_at:e.created_at,date_updated_at:e.updated_at,url:e.url,title:e.title,body:e.body,html_url:e.html_url}));h(n),S.Am.update(e,{render:"Issues Loaded successfully",type:"success",isLoading:!1,autoClose:2500})}).catch(t=>{console.log(t),S.Am.update(e,{render:"Something went wrong",type:"error",isLoading:!1,autoClose:2500})})}},A=async e=>{let n=S.Am.loading("Fetching Issues...");a.current[2]=!0,console.log("trigger reload"),await t.request({method:"get",maxBodyLength:1/0,url:"https://github-get-token-api.vercel.app/api/search-query?token="+"".concat(p)+"&query="+"".concat(e)+"&sort="+"".concat(f)}).then(e=>{console.log(e.data.items);let t=e.data.items.map(e=>({state:e.state,labels:e.labels,assignee_name:e.assignee.login,assignee_avatar_url:e.assignee.avatar_url,repository_name:e.repository_url.substring(e.repository_url.lastIndexOf("/")+1),date_created_at:e.created_at,date_updated_at:e.updated_at,url:e.url,title:e.title,body:e.body,html_url:e.html_url}));h(t),S.Am.update(n,{render:"Issues Loaded successfully",type:"success",isLoading:!1,autoClose:2500})}).catch(e=>{console.log(e),S.Am.update(n,{render:"Something went wrong",type:"error",isLoading:!1,autoClose:2500})})};return(0,i.useEffect)(()=>{a.current[3]&&(a.current[3]=!1,console.log(x))},[x]),(0,i.useEffect)(()=>{if(a.current[0]){var e;a.current[0]=!1;let n=null!==(e=localStorage.getItem("github_access_key"))&&void 0!==e?e:"";!function(e){t.request({method:"get",maxBodyLength:1/0,url:"https://github-get-token-api.vercel.app/api/validate?key="+"".concat(e)}).then(t=>{200===t.status&&(m(e),console.log("using local_key"))}).catch(e=>{localStorage.clear()})}(n);let o=window.location.search,s=new URLSearchParams(o);if(s.get("code")){let e=s.get("code");console.log("code:"+e),t.request({method:"post",maxBodyLength:1/0,url:"https://github-get-token-api.vercel.app/api/get?code="+"".concat(e)}).then(e=>{console.log(JSON.stringify(e.data)),m(e.data.access_token),localStorage.setItem("github_access_key",e.data.access_token)}).catch(e=>{console.log(e)})}}},[]),(0,i.useEffect)(()=>{a.current[4]&&""!==p&&(a.current[4]=!1,c.state?A(c.q):w(!0))},[f]),(0,i.useEffect)(()=>{a.current[1]&&""!==p&&(a.current[1]=!1,w(!0))},[p]),(0,i.useEffect)(()=>{a.current[2]&&void 0!==u&&(a.current[2]=!1,console.log("this is issue",u))},[u]),(0,i.useEffect)(()=>{a.current[5]&&(a.current[5]=!1,""!==c.q&&c.state?A(c.q):w(!0))},[c]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.ZP,{}),(0,o.jsxs)(s(),{children:[(0,o.jsx)("title",{children:"2023 Frontend Intern Homework"}),(0,o.jsx)("meta",{name:"description",content:"Generated by create next app"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsxs)(l.Z,{style:{backgroundColor:e.palette.secondary.main,minHeight:"100vh",minWidth:"1130px"},maxWidth:"xl",disableGutters:!0,children:[(0,o.jsx)(g,{clientid:"9413d76463c0af53a8a0"}),(0,o.jsx)(Y,{setQuery:k,setIssues:v,token:p,LoadIssue:w,setSortOrder:Z,sortOrder:f}),void 0!==u&&(0,o.jsx)(E,{query:c,SearchQuery:A,Data:u,token:p,callback:_,LoadIssue:w}),(0,o.jsx)(P,{query:c,SearchQuery:A,updateForm:x,handleClose:b,token:p,LoadIssue:w}),(0,o.jsx)(S.Ix,{position:"top-right",autoClose:2500,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})]})}}},function(e){e.O(0,[885,350,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);